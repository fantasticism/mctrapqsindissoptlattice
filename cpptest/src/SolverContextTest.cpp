/*
 * SolverContextText.cpp
 *
 *  Created on: Dec 25, 2017
 *      Author: fakesci
 */

#include "definitions.h"
#include "utilities.h"
#include "SolverContext.h"

TEST (SolverContext, rungeKuttaOperatorMatrixCheck) {
	const int basisSize = 16;
	Model model(2, 2, 2, 1, 1, 2, 1.0, 20.0, 50.0, 2.0, 0.1);

	SolverContext solverContext(1, 0.01, 1, model);

	const CUDA_COMPLEX_TYPE EXPECTED_RESULT[basisSize][basisSize] = { { {
			1.01309952, 0.001570133333333333 },
			{ 1.8107648, 0.2724863999999999 }, { 1.765870933333333,
					0.3041659733333334 }, { 0.6480896, 0.0498176 }, {
					2.128717653333333, 0.3095893333333333 }, {
					3.926382933333333, 0.5805056 }, { 3.881489066666667,
					0.6121851733333333 }, { 2.763707733333334,
					0.3578367999999999 }, { 2.128717653333333,
					0.3095893333333333 }, { 3.926382933333334, 0.5805056 }, {
					3.881489066666666, 0.6121851733333333 }, {
					2.763707733333333, 0.3578368000000001 }, {
					4.244335786666667, 0.6176085333333332 }, {
					6.042001066666666, 0.8885248 }, { 5.9971072,
					0.920204373333333 }, { 4.879325866666666, 0.665856 } }, { {
			1.8107648, 0.2724864 }, { 253.6951688533333, 40.79614293333333 }, {
			250.1463722666667, 40.97948160000001 }, { 91.5129514666667,
			7.253712640000001 }, { 299.6323242666667, 44.08958293333333 }, {
			550.51672832, 84.6132394666667 }, { 547.9679317333334,
			84.7965781333333 }, { 389.3345109333333, 51.07080917333334 }, {
			299.6323242666667, 44.08958293333333 }, { 550.51672832,
			84.6132394666667 }, { 547.9679317333334, 84.7965781333333 }, {
			389.3345109333333, 51.07080917333334 }, { 597.4538837333334,
			87.9066794666667 }, { 848.338287786667, 128.430336 }, { 845.7894912,
			128.6136746666666 }, { 687.1560703999999, 94.8879057066667 } },
			{ { 1.765870933333333, 0.3041659733333333 }, { 250.1463722666666,
					40.9794816 }, { 254.2696405333333, 34.89797120000001 }, {
					91.4328490666667, 6.052829866666666 }, { 299.7471744,
					40.49077290666666 },
					{ 548.1276757333335, 81.1660885333333 }, { 551.250944,
							75.08457813333334 }, { 389.4141525333334,
							46.23943680000001 }, { 299.7471744000001,
							40.49077290666666 }, { 548.1276757333332,
							81.1660885333333 },
					{ 551.250944, 75.08457813333332 }, { 389.4141525333334,
							46.23943680000001 }, { 597.7284778666667,
							80.67737984 }, { 846.1089792, 121.3526954666667 }, {
							849.232247466667, 115.2711850666667 }, {
							687.3954560000001, 86.4260437333333 } }, { {
					0.6480896, 0.04981759999999999 }, { 91.5129514666667,
					7.253712639999998 },
					{ 91.4328490666667, 6.052829866666668 }, {
							59.49477119999999, 10.7416576 }, {
							134.9539157333333, 17.67702186666667 }, {
							225.8187776000001, 24.88091690666666 }, {
							225.7386752, 23.68003413333333 }, {
							192.8005973333334, 28.36886186666668 }, {
							134.9539157333333, 17.67702186666667 }, {
							225.8187776000001, 24.88091690666666 }, {
							225.7386752, 23.68003413333333 }, {
							192.8005973333334, 28.36886186666668 }, {
							269.2597418666667, 35.30422613333333 }, {
							360.1246037333333, 42.50812117333334 }, {
							360.0445013333333, 41.30723840000001 }, {
							327.1064234666667, 45.99606613333334 } }, { {
					2.128717653333333, 0.3095893333333333 }, {
					299.6323242666666, 44.08958293333334 }, { 299.7471744,
					40.49077290666667 },
					{ 134.9539157333333, 17.67702186666667 }, {
							390.7025117866668, 64.13854720000001 }, {
							687.2061184, 107.9185408 }, { 687.3209685333333,
							104.3197307733333 }, { 522.5277098666667,
							81.5059797333333 }, { 377.34624512,
							54.81588053333335 }, { 674.8498517333334,
							98.5958741333333 }, { 674.9647018666667,
							94.9970641066667 },
					{ 510.1714432, 72.18331306666667 }, { 764.9200392533335,
							118.6448384 }, { 1062.423645866667, 162.424832 }, {
							1062.538496, 158.8260219733334 }, {
							897.745237333333, 136.0122709333333 } }, { {
					3.926382933333333, 0.5805056 }, { 550.51672832,
					84.6132394666667 }, { 548.1276757333332, 81.1660885333334 },
					{ 225.8187776000001, 24.88091690666666 }, {
							687.2061184000001, 107.9185408 }, {
							1234.796463786667, 191.9512746666666 }, {
							1231.4074112, 188.5041237333333 }, {
							909.098513066667, 132.2189521066667 }, {
							674.8498517333334, 98.5958741333333 }, {
							1221.44019712, 182.628608 }, { 1219.051144533333,
							179.1814570666667 }, { 896.7422464, 122.89628544 },
					{ 1358.1295872, 205.9339093333334 }, { 1904.719932586667,
							289.9666432000001 },
					{ 1902.33088, 286.5194922666666 }, { 1580.021981866667,
							230.23432064 } }, { { 3.881489066666666,
					0.6121851733333332 },
					{ 547.9679317333332, 84.7965781333333 }, { 551.250944,
							75.08457813333334 }, { 225.7386752,
							23.68003413333334 }, { 687.3209685333333,
							104.3197307733333 }, { 1231.4074112,
							188.5041237333333 }, { 1235.690423466667,
							178.7921237333334 }, { 909.178154666667,
							127.3875797333333 }, { 674.9647018666669,
							94.9970641066667 }, { 1219.051144533333,
							179.1814570666667 }, { 1222.3341568,
							169.4694570666667 },
					{ 896.821888, 118.0649130666667 }, { 1358.404181333333,
							198.7046097066667 }, { 1902.490624,
							282.8890026666667 }, { 1905.773636266667,
							273.1770026666667 }, { 1580.261367466667,
							221.7724586666667 } }, { { 2.763707733333333,
					0.3578367999999999 },
					{ 389.3345109333334, 51.07080917333333 }, {
							389.4141525333333, 46.23943680000001 }, {
							192.8005973333333, 28.36886186666667 }, {
							522.5277098666668, 81.5059797333333 }, {
							909.098513066667, 132.2189521066666 }, {
							909.178154666667, 127.3875797333333 }, {
							713.5645994666667, 109.5170048 }, { 510.1714432,
							72.18331306666667 }, { 896.7422464, 122.89628544 },
					{ 896.821888, 118.0649130666666 }, { 700.2083328,
							100.1943381333334 },
					{ 1029.935445333333, 153.331456 }, { 1416.506248533333,
							204.0444283733334 },
					{ 1416.585890133333, 199.213056 }, { 1219.972334933333,
							181.3424810666667 } }, { { 2.128717653333333,
					0.3095893333333333 },
					{ 299.6323242666666, 44.08958293333334 }, { 299.7471744,
							40.49077290666668 }, { 134.9539157333333,
							17.67702186666667 }, { 377.34624512,
							54.81588053333335 }, { 674.8498517333334,
							98.5958741333333 }, { 674.9647018666667,
							94.9970641066667 }, { 510.1714432000001,
							72.18331306666667 }, { 390.7025117866668,
							64.13854720000001 }, { 687.2061184, 107.9185408 }, {
							687.3209685333333, 104.3197307733333 }, {
							522.5277098666667, 81.5059797333334 }, {
							764.9200392533335, 118.6448384 }, {
							1062.423645866667, 162.424832 }, { 1062.538496,
							158.8260219733334 }, { 897.745237333334,
							136.0122709333333 } }, { { 3.926382933333333,
					0.5805055999999997 },
					{ 550.5167283199999, 84.6132394666667 }, {
							548.1276757333335, 81.1660885333334 }, {
							225.8187776, 24.88091690666666 }, {
							674.8498517333334, 98.5958741333333 }, {
							1221.44019712, 182.628608 }, { 1219.051144533333,
							179.1814570666667 }, { 896.7422464, 122.89628544 },
					{ 687.2061184000001, 107.9185408 }, { 1234.796463786667,
							191.9512746666666 }, { 1231.4074112,
							188.5041237333333 }, { 909.098513066667,
							132.2189521066667 }, { 1358.1295872,
							205.9339093333334 }, { 1904.719932586667,
							289.9666432 }, { 1902.33088, 286.5194922666666 }, {
							1580.021981866667, 230.23432064 } }, { {
					3.881489066666666, 0.6121851733333332 }, {
					547.9679317333332, 84.7965781333333 }, { 551.250944,
					75.08457813333335 }, { 225.7386752, 23.68003413333334 }, {
					674.9647018666669, 94.9970641066667 }, { 1219.051144533333,
					179.1814570666667 }, { 1222.3341568, 169.4694570666667 }, {
					896.821888, 118.0649130666667 }, { 687.3209685333333,
					104.3197307733334 }, { 1231.4074112, 188.5041237333333 }, {
					1235.690423466667, 178.7921237333333 }, { 909.178154666667,
					127.3875797333333 },
					{ 1358.404181333333, 198.7046097066667 }, { 1902.490624,
							282.8890026666667 }, { 1905.773636266667,
							273.1770026666667 }, { 1580.261367466667,
							221.7724586666667 } }, { { 2.763707733333333,
					0.3578367999999999 },
					{ 389.3345109333334, 51.07080917333333 }, {
							389.4141525333333, 46.23943680000001 }, {
							192.8005973333333, 28.36886186666667 }, {
							510.1714432, 72.18331306666667 }, { 896.7422464,
							122.89628544 }, { 896.821888, 118.0649130666667 }, {
							700.2083328, 100.1943381333334 }, {
							522.5277098666667, 81.5059797333333 }, {
							909.098513066667, 132.2189521066667 }, {
							909.178154666667, 127.3875797333333 }, {
							713.5645994666667, 109.5170048 }, {
							1029.935445333333, 153.331456 }, {
							1416.506248533333, 204.0444283733334 }, {
							1416.585890133333, 199.213056 }, {
							1219.972334933333, 181.3424810666667 } }, { {
					4.244335786666666, 0.6176085333333332 }, {
					597.4538837333332, 87.9066794666667 }, { 597.7284778666667,
					80.67737984 }, { 269.2597418666666, 35.30422613333333 }, {
					764.9200392533335, 118.6448384 }, { 1358.1295872,
					205.9339093333333 },
					{ 1358.404181333333, 198.7046097066666 }, {
							1029.935445333333, 153.331456 }, {
							764.9200392533335, 118.6448384 }, { 1358.1295872,
							205.9339093333333 }, { 1358.404181333333,
							198.7046097066666 },
					{ 1029.935445333333, 153.331456 }, { 1526.59574272,
							236.6720682666666 }, { 2118.805290666667,
							323.9611392 }, { 2119.0798848, 316.7318395733333 },
					{ 1790.6111488, 271.3586858666667 } }, { {
					6.042001066666666, 0.8885248 }, { 848.338287786667,
					128.430336 }, { 846.1089792, 121.3526954666667 }, {
					360.1246037333333, 42.50812117333334 }, { 1062.423645866667,
					162.424832 }, { 1904.719932586667, 289.9666432 }, {
					1902.490624, 282.8890026666667 }, { 1416.506248533333,
					204.0444283733333 }, { 1062.423645866667, 162.424832 }, {
					1904.719932586667, 289.9666432 }, { 1902.490624,
					282.8890026666667 },
					{ 1416.506248533333, 204.0444283733334 }, {
							2118.805290666667, 323.9611392 }, {
							2962.101577386667, 451.5029504 }, { 2958.8722688,
							444.4253098666667 }, { 2472.887893333334,
							365.5807355733335 } }, { { 5.997107199999999,
					0.920204373333333 }, { 845.7894912, 128.6136746666667 }, {
					849.232247466667, 115.2711850666667 }, { 360.0445013333334,
					41.30723839999999 }, { 1062.538496, 158.8260219733333 }, {
					1902.33088, 286.5194922666666 }, { 1905.773636266667,
					273.1770026666667 }, { 1416.585890133333, 199.213056 }, {
					1062.538496, 158.8260219733333 }, { 1902.33088,
					286.5194922666666 },
					{ 1905.773636266667, 273.1770026666666 }, {
							1416.585890133333, 199.213056 }, { 2119.0798848,
							316.7318395733333 }, { 2958.8722688,
							444.4253098666668 }, { 2963.315025066667,
							431.0828202666667 }, { 2473.127278933334,
							357.1188736000001 } }, { { 4.879325866666666,
					0.665856 }, { 687.1560703999999, 94.8879057066667 }, {
					687.395456, 86.4260437333334 }, { 327.1064234666667,
					45.99606613333333 },
					{ 897.745237333334, 136.0122709333333 }, {
							1580.021981866667, 230.23432064 }, {
							1580.261367466667, 221.7724586666666 }, {
							1219.972334933333, 181.3424810666667 }, {
							897.745237333334, 136.0122709333333 }, {
							1580.021981866667, 230.23432064 }, {
							1580.261367466667, 221.7724586666666 }, {
							1219.972334933333, 181.3424810666667 }, {
							1790.6111488, 271.3586858666667 }, {
							2472.887893333334, 365.5807355733335 }, {
							2473.127278933334, 357.1188736000001 }, {
							2113.838246399999, 316.688896 } } };

	CUDA_COMPLEX_TYPE * rungeKuttaOperator = solverContext.transferArray2Host(
			solverContext.getRungeKuttaOperatorDevPtr(), basisSize * basisSize);

	//check the matrix
	for (int i = 0; i < basisSize; ++i) {
		for (int j = 0; j < basisSize; ++j) {
			ASSERT_THAT(rungeKuttaOperator[i * basisSize + j],
					EqMatrixElementAt(EXPECTED_RESULT, i, j, RIGHT_DIGITS));
		}
	}

	delete[] rungeKuttaOperator;
}

